# Êåá‰ª§Á±ªÂûã‰∏éÂØÑÂ≠òÂô®
[ùëπùë∞ùë∫ùë™-ùëΩ Âü∫Á°Ä | suda-morris ‰∏™‰∫∫ÂçöÂÆ¢](https://suda-morris.github.io/blog/cs/risc-v.html#%E5%8D%95%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F-cpu)

| RV32I  | 47   | 32‰ΩçÂú∞ÂùÄÁ©∫Èó¥‰∏éÊï¥Êï∞Êåá‰ª§,ÊîØÊåÅ32‰∏™ÈÄöÁî®Êï¥Êï∞ÂØÑÂ≠òÂô®      |
| ------ | ---- | -------------------------------------------------- |
| RV32E  | 47   | ‰ªÖÊîØÊåÅ16‰∏™ÈÄöÁî®Êï¥Êï∞ÂØÑÂ≠òÂô®                           |
| RV64I  | 59   | 64‰ΩçÂú∞ÂùÄÁ©∫Èó¥‰∏éÊï¥Êï∞Êåá‰ª§,‰ª•Âèä‰∏ÄÈÉ®ÂàÜ64‰ΩçÂíå32‰ΩçÁöÑÊåá‰ª§  |
| RV128I | 71   | 128‰ΩçÂú∞ÂùÄÁ©∫Èó¥‰∏éÊï¥Êï∞Êåá‰ª§,‰ª•Âèä‰∏ÄÈÉ®ÂàÜ64‰ΩçÂíå32‰ΩçÁöÑÊåá‰ª§ |

| Êâ©Â±ïÊåá‰ª§ÈõÜ | Êåá‰ª§Êï∞ | ÊèèËø∞                                                |
| ---------- | ------ | --------------------------------------------------- |
| M          | 8      | Êï¥Êï∞‰πòÊ≥ï‰∏éÈô§Ê≥ïÊåá‰ª§                                  |
| A          | 11     | Â≠òÂÇ®Âô®ÂéüÂ≠êÊìç‰ΩúÂíåLoad-Reserved/Store-ConditionalÊåá‰ª§ |
| F          | 26     | ÂçïÁ≤æÂ∫¶(32bit)ÊµÆÁÇπÊåá‰ª§                               |
| D          | 26     | ÂèåÁ≤æÂ∫¶(32bit)ÊµÆÁÇπÊåá‰ª§,ÂøÖÈ°ªÊîØÊåÅFÊâ©Â±ïÊåá‰ª§             |
| C          | 46     | ÂéãÁº©Êåá‰ª§,Êåá‰ª§ÈïøÂ∫¶‰∏∫16‰Ωç                             |

| ÂØÑÂ≠òÂô®  | ABI ÂêçÂ≠ó | ÊèèËø∞                                                         | Saver  |
| ------- | -------- | ------------------------------------------------------------ | ------ |
| x0      | zero     | Á°¨‰ª∂ËøûÁ∫ø0                                                    | -      |
| x1      | ra       | ËøîÂõûÂú∞ÂùÄ                                                     | Caller |
| x2      | sp       | Ê†àÊåáÈíà                                                       | Callee |
| x3      | gp       | ÂÖ®Â±ÄÊåáÈíà                                                     | -      |
| x4      | tp       | Á∫øÁ®ãÊåáÈíà                                                     | -      |
| x5-x7   | t0-t2    | ‰∏¥Êó∂ÂØÑÂ≠òÂô®                                                   | Caller |
| x8      | s0/fp    | ‰øùÂ≠òÁöÑÂØÑÂ≠òÂô®/Â∏ßÊåáÈíà                                          | Callee |
| x9      | s1       | ‰øùÂ≠òÂØÑÂ≠òÂô® ‰øùÂ≠òÂéüËøõÁ®ã‰∏≠ÁöÑÂÖ≥ÈîÆÊï∞ÊçÆÔºå ÈÅøÂÖçÂú®ÂáΩÊï∞Ë∞ÉÁî®ËøáÁ®ã‰∏≠Ë¢´Á†¥Âùè | Callee |
| x10-x11 | a0-a1    | ÂáΩÊï∞ÂèÇÊï∞/ËøîÂõûÂÄº                                              | Caller |
| x12-x17 | a2-a7    | ÂáΩÊï∞ÂèÇÊï∞                                                     | Caller |
| x18-x27 | s2-s11   | ‰øùÂ≠òÂØÑÂ≠òÂô®                                                   | Callee |
| x28-x31 | t3-t6    | ‰∏¥Êó∂ÂØÑÂ≠òÂô®                                                   | Calle  |
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220709222553.png)

ÂÖ≠ÁßçÊåá‰ª§Ê†ºÂºè
> ÊâÄÊúâÊåá‰ª§Âú®ÂÜÖÂ≠ò‰∏≠‰ª•Â∞èÊÆµÂ≠òÊîæ
> rs:Ê∫êÂØÑÂ≠òÂô® rd:ÁõÆÁöÑÂØÑÂ≠òÂô®  imm(immediate):Á´ãÂç≥Êï∞
> func3:3‰ΩçÂäüËÉΩÁ†Å  func7:7‰ΩçÂäüËÉΩÁ†Å
> opcode ‰∏é func3„ÄÅfunc7 ÂÖ±ÂêåÂÜ≥ÂÆöÊØèÊù°Êåá‰ª§ÁöÑÂäüËÉΩ
> 
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703141227.png)

Á´ãÂç≥Êï∞Ë°®
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220709153346.png)

opcode ÂØπÂ∫îË°®
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703160638.png)

 **‰º™Êåá‰ª§**
+ ËµãÂÄºÊåá‰ª§ `move`
```asm
mv rd, rs # Á≠âÊïà‰∫é addi rd, rs, x0
```
+ Âä†ËΩΩÁ´ãÂç≥Êï∞ `load immedia`
```
li rd, 13 # Á≠âÊïà‰∫é addi rd, x0, 13
```
+ ÂáΩÊï∞Ë∞ÉÁî®ÂíåËøîÂõû
```
jal my_foo # ÂáΩÊï∞Ë∞ÉÁî®
ret # ÂáΩÊï∞ËøîÂõûÔºåÁ≠âÊïà‰∫é jr raÔºåÁ≠âÊïà‰∫é jalr x0, ra, 0
```

# cpu-test

```c
  // INSTPAT_START();
  // INSTPAT("0000000 ????? ????? 000 ????? 01100 11", add, R, R(dest) = src1 + src2);
  // INSTPAT("??????? ????? ????? 000 ????? 00100 11", addi, I, R(dest) = src1 + src2);
  // INSTPAT("??????? ????? ????? 000 ????? 00110 11", addiw, I, R(dest) = SEXT(BITS(src1 + src2, 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 000 ????? 01110 11", addw, R, R(dest) = SEXT(BITS(src1 + src2, 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 111 ????? 01100 11", and, R, R(dest) = src1 & src2);
  // INSTPAT("??????? ????? ????? 111 ????? 00100 11", andi, I, R(dest) = src1 & src2);
  // INSTPAT("??????? ????? ????? ??? ????? 00101 11", auipc, U, R(dest) = src1 + s->pc);
  // INSTPAT("??????? ????? ????? 000 ????? 11000 11", beq, B, if (src1 == src2) s->dnpc = s->pc + dest);
  // INSTPAT("??????? ????? ????? 101 ????? 11000 11", bge, B, if (S64(src1) >= S64(src2)) s->dnpc = s->pc + dest);
  // INSTPAT("??????? ????? ????? 111 ????? 11000 11", bgeu, B, if (U64(src1) >= U64(src2)) s->dnpc = s->pc + dest);
  // INSTPAT("??????? ????? ????? 100 ????? 11000 11", blt, B, if (S64(src1) < S64(src2)) s->dnpc = s->pc + dest);
  // INSTPAT("??????? ????? ????? 110 ????? 11000 11", bltu, B, if (U64(src1) < U64(src2)) s->dnpc = s->pc + dest);
  // INSTPAT("??????? ????? ????? 001 ????? 11000 11", bne, B, if (src1 != src2) s->dnpc = s->pc + dest);
  // INSTPAT("0000001 ????? ????? 100 ????? 01100 11", div, R, R(dest) = S64(src1) / S64(src2));
  // INSTPAT("0000001 ????? ????? 101 ????? 01100 11", divu, R, R(dest) = U64(src1) / U64(src2));
  // INSTPAT("0000001 ????? ????? 101 ????? 01110 11", divuw, R, R(dest) = SEXT(U32(BITS(src1, 31, 0)) / U32(BITS(src2, 31, 0)), 32));
  // INSTPAT("0000001 ????? ????? 100 ????? 01110 11", divw, R, R(dest) = SEXT(S32(BITS(src1, 31, 0)) / S32(BITS(src2, 31, 0)), 32));
  // INSTPAT("??????? ????? ????? ??? ????? 11011 11", jal, J, R(dest) = s->pc + 4; s->dnpc = s->pc + src1);
  // INSTPAT("??????? ????? ????? 000 ????? 11001 11", jalr, I, R(dest) = s->pc + 4; s->dnpc = ((src1 + src2) & (~U64(1))));
  // INSTPAT("??????? ????? ????? 000 ????? 00000 11", lb, I, R(dest) = SEXT(Mr(src1 + src2, 1), 8));
  // INSTPAT("??????? ????? ????? 100 ????? 00000 11", lbu, I, R(dest) = Mr(src1 + src2, 1));
  // INSTPAT("??????? ????? ????? 011 ????? 00000 11", ld, I, R(dest) = Mr(src1 + src2, 8));
  // INSTPAT("??????? ????? ????? 001 ????? 00000 11", lh, I, R(dest) = SEXT(Mr(src1 + src2, 2), 16));
  // INSTPAT("??????? ????? ????? 101 ????? 00000 11", lhu, I, R(dest) = Mr(src1 + src2, 2));
  // INSTPAT("??????? ????? ????? 010 ????? 00000 11", lw, I, R(dest) = SEXT(Mr(src1 + src2, 4), 32));
  // INSTPAT("??????? ????? ????? 110 ????? 00000 11", lwu, I, R(dest) = Mr(src1 + src2, 4));
  // INSTPAT("??????? ????? ????? ??? ????? 01101 11", lui, U, R(dest) = src1);
  // INSTPAT("0000001 ????? ????? 000 ????? 01100 11", mul, R, R(dest) = src1 * src2);
  // INSTPAT("0000001 ????? ????? 000 ????? 01110 11", mulw, R, R(dest) = SEXT(BITS(src1 * src2, 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 110 ????? 01100 11", or , R, R(dest) = src1 | src2);
  // INSTPAT("??????? ????? ????? 110 ????? 00100 11", ori, I, R(dest) = src1 | src2);
  // INSTPAT("0000001 ????? ????? 110 ????? 01100 11", rem, R, R(dest) = S64(src1) % S64(src2));
  // INSTPAT("0000001 ????? ????? 111 ????? 01100 11", remu, R, R(dest) = U64(src1) % U64(src2));
  // INSTPAT("0000001 ????? ????? 111 ????? 01110 11", remuw, R, R(dest) = SEXT(U32(BITS(src1, 31, 0)) % U32(BITS(src2, 31, 0)), 32));
  // INSTPAT("0000001 ????? ????? 110 ????? 01110 11", remw, R, R(dest) = SEXT(S32(BITS(src1, 31, 0)) % S32(BITS(src2, 31, 0)), 32));
  // INSTPAT("??????? ????? ????? 000 ????? 01000 11", sb, S, Mw(src1 + dest, 1, BITS(src2, 7, 0)));
  // INSTPAT("??????? ????? ????? 011 ????? 01000 11", sd, S, Mw(src1 + dest, 8, src2));
  // INSTPAT("??????? ????? ????? 001 ????? 01000 11", sh, S, Mw(src1 + dest, 2, BITS(src2, 15, 0)));
  // INSTPAT("??????? ????? ????? 010 ????? 01000 11", sw, S, Mw(src1 + dest, 4, BITS(src2, 31, 0)));
  // INSTPAT("0000000 ????? ????? 001 ????? 01100 11", sll, R, R(dest) = src1 << src2);
  // INSTPAT("000000? ????? ????? 001 ????? 00100 11", slli, I, R(dest) = src1 << src2);
  // INSTPAT("000000? ????? ????? 001 ????? 00110 11", slliw, I, R(dest) = SEXT(BITS(src1 << src2, 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 001 ????? 01110 11", sllw, R, R(dest) = SEXT(BITS(src1 << BITS(src2, 4, 0), 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 010 ????? 01100 11", slt, R, R(dest) = S64(src1) < S64(src2));
  // INSTPAT("??????? ????? ????? 010 ????? 00100 11", slti, I, R(dest) = S64(src1) < S64(src2));
  // INSTPAT("??????? ????? ????? 011 ????? 00100 11", sltiu, I, R(dest) = U64(src1) < U64(src2));
  // INSTPAT("0000000 ????? ????? 011 ????? 01100 11", sltu, R, R(dest) = U64(src1) < U64(src2));
  // INSTPAT("0100000 ????? ????? 101 ????? 01100 11", sra, R, R(dest) = S64(src1) >> src2);
  // INSTPAT("010000? ????? ????? 101 ????? 00100 11", srai, I, R(dest) = S64(src1) >> src2);
  // INSTPAT("010000? ????? ????? 101 ????? 00110 11", sraiw, I, R(dest) = SEXT(S32(BITS(src1, 31, 0)) >> src2, 32));
  // INSTPAT("0100000 ????? ????? 101 ????? 01110 11", sraw, R, R(dest) = SEXT(S32(BITS(src1, 31, 0)) >> BITS(src2, 4, 0), 32));
  // INSTPAT("0000000 ????? ????? 101 ????? 01100 11", srl, R, R(dest) = U64(src1) >> src2);
  // INSTPAT("000000? ????? ????? 101 ????? 00100 11", srli, I, R(dest) = U64(src1) >> src2);
  // INSTPAT("000000? ????? ????? 101 ????? 00110 11", srliw, I, R(dest) = SEXT(U32(BITS(src1, 31, 0)) >> src2, 32));
  // INSTPAT("0000000 ????? ????? 101 ????? 01110 11", srlw, R, R(dest) = SEXT(U32(BITS(src1, 31, 0)) >> BITS(src2, 4, 0), 32));
  // INSTPAT("0100000 ????? ????? 000 ????? 01100 11", sub, R, R(dest) = src1 - src2);
  // INSTPAT("0100000 ????? ????? 000 ????? 01110 11", subw, R, R(dest) = SEXT(BITS(src1 - src2, 31, 0), 32));
  // INSTPAT("0000000 ????? ????? 100 ????? 01100 11", xor, R, R(dest) = src1 ^ src2);
  // INSTPAT("??????? ????? ????? 100 ????? 00100 11", xori, I, R(dest) = src1 ^ src2);


  // INSTPAT("0000000 00001 00000 000 00000 11100 11", ebreak, N, NEMUTRAP(s->pc, R(10))); // R(10) is $a0
  // INSTPAT("??????? ????? ????? ??? ????? ????? ??", inv, N, INV(s->pc));
  // INSTPAT_END();
```
Ê≥®ÊÑèÔºö
ÈúÄË¶ÅÁâπÂà´Ê≥®ÊÑè `ÂàÜÊîØÊåá‰ª§` ÔºåÂíåÁßª‰ΩçÊåá‰ª§ÔºåÊúâÁ¨¶Âè∑Êï∞ÂíåÊó†Á¨¶Âè∑Êï∞ÈúÄË¶ÅÁâπÂà´ÊåáÂÆö
## dummy.c
> ÊúÄÁÆÄÂçïÁöÑÁ®ãÂ∫è
```c
int main() {
¬† return 0;
}
```
**ÂèçÊ±áÁºñÂ¶Ç‰∏ã**
```asm
Disassembly of section .text:

0000000080000000 <_start>:
    80000000:	00000413          	li	s0,0                           //Á≠âÊïà‰∫é addi s0 x0 0
    80000004:	00009117          	auipc	sp,0x9
    80000008:	ffc10113          	addi	sp,sp,-4 # 80009000 <_end>
    8000000c:	00c000ef          	jal	ra,80000018 <_trm_init>

0000000080000010 <main>:
    80000010:	00000513          	li	a0,0
    80000014:	00008067          	ret

0000000080000018 <_trm_init>:
    80000018:	ff010113          	addi	sp,sp,-16
    8000001c:	00000517          	auipc	a0,0x0
    80000020:	01c50513          	addi	a0,a0,28 # 80000038 <_etext>
    80000024:	00113423          	sd	ra,8(sp)
    80000028:	fe9ff0ef          	jal	ra,80000010 <main>
    8000002c:	00050513          	mv	a0,a0
    80000030:	00100073          	ebreak
    80000034:	0000006f          	j	80000034 <_trm_init+0x1c>
```
### Ê∂âÂèäÊåá‰ª§
+ addi
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703163706.png)
+ jal
>Ë∑≥ËΩ¨Âπ∂ÈìæÊé•Êåá‰ª§ÔºàjalÔºâÂÖ∑ÊúâÂèåÈáçÂäüËÉΩ„ÄÇËã•Â∞Ü‰∏ã‰∏ÄÊù°Êåá‰ª§ PC + 4 ÁöÑÂú∞ÂùÄ‰øùÂ≠òÂà∞ÁõÆÊ†áÂØÑÂ≠òÂô®‰∏≠ÔºåÈÄöÂ∏∏ÊòØËøîÂõûÂú∞ÂùÄÂØÑÂ≠òÂô® raÔºàËßÅÂõæ 2.4ÔºâÔºå‰æøÂèØ‰ª•Áî®ÂÆÉÊù•ÂÆûÁé∞ËøáÁ®ãË∞ÉÁî®„ÄÇÂ¶ÇÊûú‰ΩøÁî®Èõ∂ÂØÑÂ≠òÂô®Ôºàx0ÔºâÊõøÊç¢ ra ‰Ωú‰∏∫ÁõÆÊ†áÂØÑÂ≠òÂô®ÔºåÂàôÂèØ‰ª•ÂÆûÁé∞Êó†Êù°‰ª∂Ë∑≥ËΩ¨ÔºåÂõ†‰∏∫ x0 ‰∏çËÉΩÊõ¥Êîπ„ÄÇÂÉèÂàÜÊîØ‰∏ÄÊ†∑Ôºåjal Â∞ÜÂÖ∂ **20 ‰ΩçÂàÜÊîØÂú∞ÂùÄ‰πò‰ª• 2ÔºåËøõË°åÁ¨¶Âè∑Êâ©Â±ï**ÂêéÂÜçÊ∑ªÂä†Âà∞ PC ‰∏äÔºå‰æøÂæóÂà∞‰∫ÜË∑≥ËΩ¨Âú∞ÂùÄ„ÄÇ
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703171106.png)

+ jalr
>‰π¶‰∏≠ÁøªËØëÂá∫ÈîôÔºåfun3 ‰∏çÊòØ 010ÔºåÂèÇËÄÉÂéüÁâàÂèëÁé∞‰∏∫ 000.

![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703183200.png)
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220703185307.png)
## add.c
+ lw
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220704122910.png)
+ addw
+ addiw
+ sub
+ sltiu
+ bne
+ beq

## fact.c
+ sw
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220704123123.png)
+ mulw
![](https://cdn.jsdelivr.net/gh/zilongmix/doc/img/20220704123555.png)

